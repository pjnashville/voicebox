<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Voicebox</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f0f1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link rel="stylesheet" href="style.css?v=21">
</head>
<body>

  <!-- ===== RECORD VIEW (default) ===== -->
  <section id="view-record" class="view active">
    <header>
      <h1>voicebox</h1>
      <div class="header-controls">
        <label class="auto-record-toggle" for="auto-record-toggle">
          <span class="auto-record-label">Auto</span>
          <input type="checkbox" id="auto-record-toggle">
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
        </label>
        <button id="btn-help" class="icon-btn help-btn" aria-label="Help">?</button>
        <button id="btn-settings" class="icon-btn" aria-label="Settings">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </button>
      </div>
    </header>

    <!-- History list (scrollable) -->
    <div class="history-section">
      <div class="history-header">
        <h2>History</h2>
        <button id="btn-clear-all" class="btn-clear-all hidden">Clear All</button>
      </div>
      <div id="history-list" class="history-list">
        <p class="empty-state" id="history-empty">No recordings yet</p>
      </div>
    </div>

    <!-- Record bar (fixed bottom quarter) -->
    <div id="record-bar" class="record-bar">
      <div id="kitt-bar" class="kitt-bar"></div>
      <div id="recording-indicator" class="recording-indicator">
        <span class="pulse-dot"></span>
        <span id="recording-time">0:00</span>
      </div>
      <button id="btn-cancel" class="btn-cancel cancel-hidden">Cancel</button>
      <button id="btn-record" class="record-btn" aria-label="Record">
        <svg class="mic-icon" width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
        <svg class="stop-icon hidden" width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
        <span class="record-btn-label" id="record-btn-label">Tap to record</span>
      </button>
      <div id="app-selector" class="app-selector"></div>
    </div>
  </section>

  <!-- ===== RESULT VIEW ===== -->
  <section id="view-result" class="view">
    <header>
      <button id="btn-result-back" class="icon-btn" aria-label="Back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
      </button>
      <h1 id="result-title">Recording</h1>
      <button id="btn-delete" class="icon-btn danger" aria-label="Delete">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
      </button>
    </header>

    <div class="result-content">
      <div id="result-status" class="result-status">
        <div id="transcribing-spinner" class="spinner-wrap hidden">
          <div class="spinner"></div>
          <p>Transcribing...</p>
        </div>
        <div id="transcribe-error" class="error-wrap hidden">
          <p class="error-msg" id="error-msg">Transcription failed</p>
          <button id="btn-retry" class="btn btn-accent">Retry</button>
        </div>
      </div>

      <div id="result-text-wrap" class="result-text-wrap hidden">
        <textarea id="result-text" class="result-text" readonly placeholder="Transcription will appear here..."></textarea>
      </div>

      <div id="result-playback" class="result-playback hidden">
        <button id="btn-result-play" class="result-play-btn" aria-label="Play">
          <svg class="play-progress-ring result-ring" viewBox="0 0 48 48">
            <circle class="ring-bg" cx="24" cy="24" r="21"/>
            <circle class="ring-fg" cx="24" cy="24" r="21"
              stroke-dasharray="131.95" stroke-dashoffset="131.95" data-circumference="131.95"/>
          </svg>
          <svg class="play-pause-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="6,4 20,12 6,20"/></svg>
        </button>
        <span id="result-play-time" class="result-play-time">0:00</span>
      </div>

      <div class="result-meta">
        <span id="result-date"></span>
        <span id="result-duration"></span>
      </div>

      <div id="result-actions" class="result-actions hidden">
        <button id="btn-copy" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
          Copy
        </button>
        <button id="btn-share" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          Share
        </button>
      </div>

    </div>
  </section>

  <!-- ===== SETTINGS VIEW ===== -->
  <section id="view-settings" class="view">
    <header>
      <button id="btn-settings-back" class="icon-btn" aria-label="Back">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
      </button>
      <h1>Settings</h1>
      <span></span>
    </header>

    <div class="settings-content">
      <!-- API Key -->
      <label class="field-label" for="api-key-input">OpenAI API Key</label>
      <div class="key-input-wrap">
        <input type="password" id="api-key-input" class="text-input" placeholder="sk-..." autocomplete="off">
        <button id="btn-toggle-key" class="icon-btn" aria-label="Show/hide key">
          <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
      </div>
      <button id="btn-save-key" class="btn btn-accent settings-btn">Save Key</button>
      <button id="btn-test-key" class="btn btn-secondary settings-btn">Test Key</button>
      <p id="settings-status" class="settings-status"></p>

      <!-- Custom Vocabulary -->
      <label class="field-label" for="vocab-input">Custom Vocabulary</label>
      <p class="field-hint">Names, terms, or words Whisper might mishear (comma-separated)</p>
      <textarea id="vocab-input" class="text-input vocab-input" placeholder="e.g. Acme Corp, Kubernetes, LangChain" rows="3"></textarea>
      <button id="btn-save-vocab" class="btn btn-secondary settings-btn">Save Vocabulary</button>

      <!-- Storage -->
      <div class="settings-divider"></div>
      <label class="field-label">Storage</label>
      <p class="field-hint" id="storage-info">Calculating...</p>
      <p class="field-hint">Audio blobs older than 30 days are auto-deleted (transcriptions kept).</p>
      <button id="btn-delete-all" class="btn btn-danger settings-btn">Delete All Recordings</button>
    </div>
  </section>

  <script type="module" src="app.js?v=21"></script>
</body>
</html>
